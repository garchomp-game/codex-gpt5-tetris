# ブラウザ版テトリス 要件定義

## 1. プロジェクト概要
- **目的**: PCとモバイルのウェブブラウザ上でプレイ可能なテトリス風パズルゲームを提供し、シンプルな操作とスムーズなゲーム体験を実現する。
- **ターゲットユーザー**: カジュアルゲームを楽しむライトユーザー、テトリス経験者、短時間の暇つぶしを求めるユーザー。
- **提供形態**: シングルページアプリケーション (SPA) として公開し、インストール不要でプレイ開始できる。

## 2. スコープ
- **MVP範囲**
  - シングルプレイヤーモードのみ。
  - テトリミノ(7種類)の自動落下、移動、回転、ホールド機能。
  - スコアリング、レベルアップ、ゲームオーバー判定。
  - キーボード操作と画面ボタンによる操作サポート。
  - 画面サイズに応じたレスポンシブレイアウト。
  - プレイ履歴(ベストスコア)のローカル保存。
- **非スコープ**
  - オンライン対戦、ランキングサーバー連携。
  - 課金要素、広告連携。
  - 外部アカウント連携やログイン機能。

## 3. 成功指標
- 初回アクセスから5秒以内にゲームが開始可能である。
- 主要ブラウザ(Chrome / Firefox / Safari / Edge)の最新2バージョンで動作確認済み。
- 60fpsを維持できる(低スペック端末では30fpsを下限とする)。

## 4. ユーザーストーリー
- プレイヤーとして、キーボードまたはタッチ操作でテトリミノを制御し、ラインを揃えてスコアを稼ぎたい。
- 初回利用者として、ルール説明や操作方法を短時間で把握したい。
- リピーターとして、自分のベストスコアを確認し、更新したい。

## 5. ゲームプレイ要件
- **テトリミノ**: I, O, T, S, Z, J, Lの7種類を実装。バッグ方式による出現順制御(7個1セットでシャッフル)を採用。
- **フィールド**: 幅10マス × 高さ20マス。天井上に2段のバッファを用意。
- **落下速度**: レベルに応じた落下速度テーブルを設定。レベル1は1秒/セル、レベルが上がるごとに短縮。
- **レベルアップ条件**: 消したライン数の累計に応じてレベル上昇(例: 10ラインごと)。最大レベルは10。
- **スコアリング**:
  - 1ライン: 100点
  - 2ライン: 300点
  - 3ライン: 500点
  - 4ライン(テトリス): 800点
  - ソフトドロップ: 1セルごとに1点
  - ハードドロップ: 1セルごとに2点
  - T-Spin: 実装の可否は検討(任意要件)。
- **ホールド機能**: 1回の落下につき1回までホールド可能。ホールド中は現在のピースと交換。
- **ゴーストピース**: デフォルトで表示。設定からON/OFF切替可能。
- **ゲームオーバー**: 新しいテトリミノをスポーンする位置にブロックが存在する場合。
- **ポーズ**: `P`キーまたはUIボタンで一時停止。

## 6. 操作要件
- **キーボード**
  - 左移動: `←`、`A`
  - 右移動: `→`、`D`
  - ソフトドロップ: `↓`、`S`
  - ハードドロップ: `Space`
  - 左回転: `Z`
  - 右回転: `X` または `↑`
  - 180度回転(任意): `C`
  - ホールド: `Shift`
  - ポーズ: `P`
- **タッチ/クリック操作**
  - 画面下部に操作パネル(移動・回転・ドロップ・ホールド)。
  - モバイルではフリックで移動/ドロップできるオプションを検討。

## 7. UI/UX 要件
- **レイアウト**
  - 中央にプレイフィールド。
  - 右側に次のピース(最大5個表示)、ホールド枠、スコア、レベル、ラインカウンタ。
  - 上部またはモーダルで操作説明を表示できるヘルプボタン。
- **スタイル**
  - 近未来的・明るいカラーリング。
  - モード切替(ライト/ダークテーマ)は任意要件。
- **レスポンシブ**
  - スマホ: 縦画面でプレイ可能。操作パネルをフィールド下に配置。
  - タブレット/PC: 16:9前後の比率でフィールドを最大化。
- **フィードバック**
  - ライン消去時にエフェクトとサウンドを再生。
  - ハードドロップ時に軽微なシェイク演出。
  - ポーズ中はフィールドを暗転、メニューを重ねる。

## 8. オーディオ要件
- BGM: ループ再生(ミュート可能)。
- SE: ドロップ、ライン消去、レベルアップ、ゲームオーバーなど。
- 音量調整スライダー、ミュートボタンを用意。

## 9. アクセシビリティ
- 色覚バリアフリーを考慮し、ピースの色と模様を併用。
- 音声フィードバックに依存しない情報提示(視覚的エフェクト)。
- キーボード専用コントロールの提供。
- 操作説明や設定画面を読み上げ対応(ARIA属性活用)。

## 10. 技術要件
- **フロントエンド**: Vue 3 (Composition API) + TypeScript。
- **状態管理**: Piniaでゲームステート(フィールド、キュー、ホールド、スコア等)を集中管理し、型安全に操作する。
- **レンダリング**: Canvas APIまたはSVGいずれかを選択。パフォーマンス観点からCanvasを第一候補。
- **ビルドツール**: Viteを利用して高速開発環境を構築。
- **スタイル**: CSS ModulesまたはScoped CSSを基本とし、共通スタイルは`src/styles`配下に管理。
- **Lint/Format**: ESLint + Prettier。Vue用プラグインとTypeScriptサポートを有効化。
- **テスト**: Vitest + @vue/test-utilsでロジック/コンポーネント単体テスト。PlaywrightによるE2Eテストを任意要件で検討。
- **ローカルストレージ**: ブラウザのLocalStorageにベストスコアを保存。

## 11. 基本設計
- **ディレクトリ構成**
  - `src/components` : UIコンポーネント(フィールド、ホールド、ネクスト、操作パネル等)。
  - `src/stores` : Piniaストア(ゲーム状態、設定、オーディオ)。
  - `src/game` : ピース生成やコアロジック、ユーティリティ。
  - `src/assets` : 画像、サウンド、共通スタイル。
- **コンポーネント構成(想定)**
  - `GameView` : 画面全体のコンテナ。ストアから状態を購読。
  - `PlayfieldCanvas` : フィールド描画とレンダリングループ。
  - `NextQueue`, `HoldPanel` : 次ピース/ホールド枠。
  - `StatusPanel` : スコア、レベル、ライン表示。
  - `ControlPanel` : タッチ操作ボタン、ポーズボタン。
  - `SettingsModal`, `HelpModal` : 設定とヘルプ。
- **Piniaストア構成**
  - `useGameStore` : フィールド状態、アクティブピース、キュー、ホールド、ゲームループ制御を担当。
  - `useSettingsStore` : 音量、ゴーストピース、操作設定。
  - `useAudioStore` : BGM/SEの再生管理(任意)。
- **描画/ロジック分離**: 描画はCanvasコンポーネントに閉じ込め、ロジックは`src/game`配下の純粋関数で管理。テスト容易性を高める。
- **入力処理**: コンポーネントで入力イベントを受け取り、ゲームストアのアクションを呼び出す。キーコンフィグは設定ストアから参照。

## 12. パフォーマンス & 品質
- 初回ロードサイズ 500KB 未満(圧縮後)を目標。
- メインスレッドブロッキング時間を最小化(50ms未満)。
- 連続操作への応答遅延を16ms以下に抑制。
- 主要機能に対する単体テストカバレッジ70%以上。

## 13. ローカライズ
- MVPでは日本語UIを提供。
- テキストは翻訳可能な構造(キー/値形式)で保持し、将来的な多言語展開を容易にする。

## 14. 設定メニュー
- 音量調整・ミュート。
- ゴーストピースのON/OFF。
- ハードドロップのON/OFF。
- 操作キーの割り当て変更(任意要件)。
- テーマ切替(任意要件)。

## 15. 開発プロセスとマイルストーン
1. 要件定義(本資料) - 完了
2. ゲームコアロジック実装 - 2週間
3. UI実装 & レスポンシブ対応 - 1週間
4. オーディオ & 設定機能実装 - 1週間
5. テスト & 調整 - 1週間
6. βリリース & フィードバック反映 - 1週間

## 16. リスクと対応策
- **ブラウザ互換性**: 早期に動作テストを行い、Polyfillやフォールバック実装で対応。
- **パフォーマンス低下**: プロファイリングを実施し、描画やループ処理を最適化。
- **操作性の個人差**: ユーザーテストを行い、設定でカスタマイズ可能にする。

## 17. 将来拡張(任意)
- タイムアタックモードやチャレンジモードの追加。
- オンラインランキング、SNSシェア機能。
- PWA対応によるオフラインプレイ。
- アチーブメントシステム。
